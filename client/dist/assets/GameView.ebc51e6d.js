var I=Object.defineProperty,A=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var w=(t,i,e)=>i in t?I(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,l=(t,i)=>{for(var e in i||(i={}))$.call(i,e)&&w(t,e,i[e]);if(g)for(var e of g(i))C.call(i,e)&&w(t,e,i[e]);return t},f=(t,i)=>A(t,E(i));import{_ as h}from"./index.a64deb2c.js";import{d as r,o as s,b as a,y as R,m as x,e as _,F as u,p as P,g as L,z as p,w as B,r as v,A as k,v as S,B as X}from"./vendor.7e421787.js";import{G as M}from"./GameApi.fbabae60.js";const z=r({name:"BaseLayer"}),T={id:"mainSVG"};function V(t,i,e,n,c,o){return s(),a("svg",T,[R(t.$slots,"default",{},void 0,!0)])}var G=h(z,[["render",V],["__scopeId","data-v-e882053c"]]);const Y=r({name:"Player",props:{character:{type:Object,required:!0}},data(){return{playerSize:50,xAxis:100,yAxis:100,xDir:"",yDir:"",direction:"",ticks:0,ticksRate:10,acceleration:1,velocity:0,maxVelocity:10,heading:"",gameLoop:null,mainSVG:document.getElementById("mainSVG")}},computed:f(l({},x(["socket"])),{inputs(){return this.xDir||this.yDir},noInputs(){return!this.xDir&&!this.yDir}}),created(){this.setStartingPosition(),this.loop();let t=e=>{e.preventDefault(),e.key==="Escape"&&window.removeEventListener("keydown",t,!1),(e.key==="ArrowUp"||e.key==="w")&&(this.yDir="up"),(e.key==="ArrowLeft"||e.key==="a")&&(this.xDir="left"),(e.key==="ArrowDown"||e.key==="s")&&(this.yDir="down"),(e.key==="ArrowRight"||e.key==="d")&&(this.xDir="right"),this.direction=this.yDir+this.xDir},i=e=>{e.preventDefault(),e.key==="Escape"&&window.removeEventListener("keydown",i,!1),["ArrowUp","ArrowDown","w","s"].includes(e.key)&&(this.yDir=""),["ArrowLeft","ArrowRight","a","d"].includes(e.key)&&(this.xDir="")};window.addEventListener("keydown",t),window.addEventListener("keyup",i)},methods:{loop(){this.ticks++,this.update(),requestAnimationFrame(this.loop)},setStartingPosition(){this.xAxis=this.character.position.xAxis,this.yAxis=this.character.position.yAxis},update(){this.inputs?(this.ticks%this.ticksRate===0&&(this.velocity<this.maxVelocity?this.velocity+=this.acceleration:this.velocity=this.maxVelocity),this.movePlayer()):this.direction&&(this.movePlayer(),this.ticks%this.ticksRate===0&&(this.velocity>0?this.velocity-=this.acceleration:(this.velocity=0,this.direction="")))},movePlayer(){var i;let t=!1;if(this.direction.includes("up")&&(this.yAxis-this.velocity<50?this.yAxis=this.playerSize:this.yAxis-=this.velocity,t=!0),this.direction.includes("left")&&(this.xAxis-this.velocity<50?this.xAxis=this.playerSize:this.xAxis-=this.velocity,t=!0),this.direction.includes("down")&&(this.yAxis+this.velocity>670?this.yAxis=670:this.yAxis+=this.velocity,t=!0),this.direction.includes("right")){let e=(i=document.getElementById("mainSVG"))==null?void 0:i.getBoundingClientRect().width;e&&(this.xAxis+this.velocity>e-this.playerSize?this.xAxis=e-this.playerSize:this.xAxis+=this.velocity,t=!0)}t&&this.persistPosition()},persistPosition(){this.socket.emit("positionUpdated",this.character._id,{xAxis:this.xAxis,yAxis:this.yAxis})}}}),U=["fill","cx","cy","r"];function q(t,i,e,n,c,o){return s(),a("circle",{ref:"player",fill:t.character.attributes.color,cx:t.xAxis,cy:t.yAxis,r:t.character.attributes.size},null,8,U)}var F=h(Y,[["render",q]]);const O=r({name:"OtherPlayer",props:{character:{type:Object,required:!0}}}),W=["fill","cx","cy","r"];function j(t,i,e,n,c,o){return s(),a("circle",{ref:"player",fill:t.character.attributes.color,cx:t.character.position.xAxis,cy:t.character.position.yAxis,r:t.character.attributes.size},null,8,W)}var H=h(O,[["render",j]]);const J=r({data(){return{wrapper:{},canvasEl:{},canvas:{},background:{x:0,y:0,width:512,height:480},backgroundReady:!1,backgroundImg:new Image,charReady:!1,charImg:new Image,char:{x:50,y:50,width:20,height:42,spriteX:0,spriteY:0,speed:150,edgeRegion:50,moving:!1,animateTime:2,animateCur:0,animatePos:[0,42,84,42,0,128,170,128]},keysDown:{},then:Date.now(),now:Date.now()}},mounted(){var t;this.wrapper=document.getElementById("gameWrapper"),this.canvasEl=document.createElement("canvas"),this.canvas=this.canvasEl.getContext("2d"),this.canvasEl.width=450,this.canvasEl.height=300,(t=this.wrapper)==null||t.appendChild(this.canvasEl),this.backgroundImg.onload=()=>{this.backgroundReady=!0},this.backgroundImg.src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/15388/background.png",this.charImg.onload=()=>{this.charReady=!0},this.charImg.src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/15388/knightd25b8b7e.png",addEventListener("keydown",i=>{this.char.moving=!0,this.keysDown[i.keyCode]=!0},!1),addEventListener("keyup",i=>{this.char.moving=!1,delete this.keysDown[i.keyCode]},!1),this.render(),this.then=Date.now(),this.mainInterval()},methods:{update(t){37 in this.keysDown&&(this.char.spriteX=170,Math.round(this.char.x)>this.char.edgeRegion?this.char.x-=this.char.speed*t:Math.round(this.background.x)<0?this.background.x+=this.char.speed*t:Math.round(this.char.x)>0&&(this.char.x-=this.char.speed*t)),38 in this.keysDown&&(this.char.spriteX=74,Math.round(this.char.y)>this.char.edgeRegion?this.char.y-=this.char.speed*t:Math.round(this.background.y)<0?this.background.y+=this.char.speed*t:Math.round(this.char.y)>0&&(this.char.y-=this.char.speed*t)),39 in this.keysDown&&(this.char.spriteX=148,Math.round(this.char.x)+this.char.width<this.canvasEl.width-this.char.edgeRegion?this.char.x+=this.char.speed*t:Math.round(this.background.x)>this.canvasEl.width-this.background.width?this.background.x-=this.char.speed*t:Math.round(this.char.x)+this.char.width<this.canvasEl.width&&(this.char.x+=this.char.speed*t)),40 in this.keysDown&&(this.char.spriteX=0,Math.round(this.char.y)+this.char.height<this.canvasEl.height-this.char.edgeRegion?this.char.y+=this.char.speed*t:Math.round(this.background.y)>this.canvasEl.height-this.background.height?this.background.y-=this.char.speed*t:Math.round(this.char.y)+this.char.height<this.canvasEl.height&&(this.char.y+=this.char.speed*t)),37 in this.keysDown&&38 in this.keysDown&&(this.char.spriteX=124),38 in this.keysDown&&39 in this.keysDown&&(this.char.spriteX=100),39 in this.keysDown&&40 in this.keysDown&&(this.char.spriteX=50),40 in this.keysDown&&37 in this.keysDown&&(this.char.spriteX=26)},render(){var t,i,e;(t=this.canvas)==null||t.clearRect(0,0,this.canvasEl.width,this.canvasEl.height),this.char.moving&&(this.char.animateTime>0?this.char.animateTime--:(this.char.animateCur+1<this.char.animatePos.length?(this.char.animateCur++,this.char.spriteY=this.char.animatePos[this.char.animateCur]):(this.char.animateCur=0,this.char.spriteY=this.char.animatePos[0]),this.char.animateTime=2)),this.backgroundReady&&((i=this.canvas)==null||i.drawImage(this.backgroundImg,this.background.x,this.background.y)),this.charReady&&((e=this.canvas)==null||e.drawImage(this.charImg,this.char.spriteX,this.char.spriteY,this.char.width,this.char.height,this.char.x,this.char.y,this.char.width,this.char.height))},mainInterval(){this.now=Date.now();var t=this.now-this.then;this.update(t/1e3),this.render(),this.then=this.now,requestAnimationFrame(this.mainInterval)}}}),N={id:"gameWrapper"};function K(t,i,e,n,c,o){return s(),a("div",N)}var Q=h(J,[["render",K],["__scopeId","data-v-45fe0c52"]]);const Z=r({name:"TestCanvasLayer",data(){return{wrapper:{},canvasEl:{},canvas:{},background:{x:0,y:0,width:512,height:480},backgroundReady:!1,backgroundImg:new Image,charReady:!1,charImg:new Image,char:{x:50,y:50,width:20,height:42,spriteX:0,spriteY:0,speed:150,edgeRegion:50,moving:!1,animateTime:2,animateCur:0,animatePos:[0,42,84,42,0,128,170,128]},keysDown:{},then:Date.now(),now:Date.now()}},async mounted(){var t,i,e;this.wrapper=document.getElementById("gameWrapper"),this.canvasEl=document.createElement("canvas"),this.canvas=await this.canvasEl.getContext("2d"),this.canvasEl.width=1028,this.canvasEl.height=768,(t=this.wrapper)==null||t.appendChild(this.canvasEl),this.backgroundImg.onload=()=>{this.backgroundReady=!0},this.backgroundImg.src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/15388/background.png",this.charImg.onload=()=>{this.charReady=!0},this.charImg.src="/public/dude.png",(i=this.canvas)==null||i.drawImage(this.backgroundImg,this.background.x,this.background.y),(e=this.canvas)==null||e.drawImage(this.charImg,this.char.spriteX,this.char.spriteY,this.char.width,this.char.height,this.char.x,this.char.y,this.char.width,this.char.height)},methods:{render(){var t,i,e;(t=this.canvas)==null||t.clearRect(0,0,this.canvasEl.width,this.canvasEl.height),this.char.moving&&(this.char.animateTime>0?this.char.animateTime--:(this.char.animateCur+1<this.char.animatePos.length?(this.char.animateCur++,this.char.spriteY=this.char.animatePos[this.char.animateCur]):(this.char.animateCur=0,this.char.spriteY=this.char.animatePos[0]),this.char.animateTime=2)),this.backgroundReady&&((i=this.canvas)==null||i.drawImage(this.backgroundImg,this.background.x,this.background.y)),this.charReady&&((e=this.canvas)==null||e.drawImage(this.charImg,this.char.spriteX,this.char.spriteY,this.char.width,this.char.height,this.char.x,this.char.y,this.char.width,this.char.height))},mainInterval(){this.now=Date.now(),this.now-this.then,this.render(),this.then=this.now,console.log("test"),requestAnimationFrame(this.mainInterval)},test(){var t;(t=this.canvas)==null||t.clearRect(0,0,this.canvasEl.width,this.canvasEl.height)}}}),tt=t=>(P("data-v-418ecdf0"),t=t(),L(),t),et=tt(()=>_("div",{id:"gameWrapper"},null,-1));function it(t,i,e,n,c,o){return s(),a(u,null,[_("button",{onClick:i[0]||(i[0]=(...d)=>t.test&&t.test(...d))},"delete"),et],64)}var st=h(Z,[["render",it],["__scopeId","data-v-418ecdf0"]]);const at=r({name:"GameView",components:{TestCanvasLayer:st,BaseCanvasLayer:Q,Player:F,BaseLayer:G,OtherPlayer:H},data(){return{character:{},otherCharacters:{}}},computed:l({},x(["socket"])),beforeCreate:async function(){await M.getCharacters().then(t=>{this.character=t.data[0]}),this.socket.emit("pendingGameJoin",this.character),this.socket.on("playerJoined",t=>{this.otherCharacters=t}),this.socket.on("positionUpdated",(t,i)=>{this.otherCharacters[t].position=i})},beforeUnmount(){this.socket.emit("playerLeft",this.character)}});function ht(t,i,e,n,c,o){const d=v("Player"),b=v("BaseLayer");return s(),p(b,null,{default:B(()=>[t.character?(s(),p(d,{key:0,character:t.character},null,8,["character"])):k("",!0),(s(!0),a(u,null,S(t.otherCharacters,(D,y)=>{var m;return s(),a(u,{key:y},[((m=t.character)==null?void 0:m._id)!==y?(s(),p(X("OtherPlayer"),{key:0,character:D},null,8,["character"])):k("",!0)],64)}),128))]),_:1})}var dt=h(at,[["render",ht]]);export{dt as default};
